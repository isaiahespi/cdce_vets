---
title: "Survey Experiment"
author:
  - name: Isaiah
    #orcid: 0000-0002-0760-5497
    #corresponding: true
    degrees:
    email: gespinoz@umd.edu
    roles:
      - Research Assistant
      - Reviewer
      - Analyst
    affiliations:
      - Center for Democracy and Civic Engagement
      - University of Maryland at College Park 
  # - name: Rowan Cockett
  #   orcid: 0000-0002-7859-8394
  #   corresponding: false
  #   roles: []
  #   affiliations:
  #     - Curvenote

phone: (410) 903 6911
email: ssnovey@umd.edu
department: Center for Democracy and Civic Engagement
keywords:
  - Election Workers
  - Poll workers
  - Veterans
  - Public opinion
  - Election administration
plain-language-summary: |
  Analysis and results of survey experiment.
key-points:  
  - Lorem ipsum odor amet, consectetuer adipiscing elit.
  - Lorem ipsum odor amet, consectetuer adipiscing elit.
  - Lorem ipsum odor amet, consectetuer adipiscing elit.
date: 2024-09-12
# bibliography: references.bib
# csl: american-political-science-association.csl
link-citations: true
tbl-cap-location: margin
fig-cap-location: margin
citation:
  container-title: Center for Democracy and Civic Engagement, University of Maryland
number-sections: false
execute: 
  cache: false
---



```{r}
#| label: setup
#| echo: true
#| output: false

# load packages
library(tidyverse)
library(janitor)
library(table1)
library(kableExtra)

# load data
load("data/df-2024-09-11.Rdata") # df set as factor with dummy vars
load("data/data_numeric_vets_survey-exp-2024-09-11.Rdata") # numeric only

# load data dictionary/codebook
df_dict <- read.csv("codebooks/df_dict.csv")
```


```{r}
#| label: setup2
#| echo: false
#| output: false

# save variables of interest as character vectors (or objects or whatever)
# this is only so I can iterate the creation of tables and plots for each
# variable without the need to manually create a table or plot for each one
# questions related to Maricopa County, AZ 
qs_az <- df |>
  select(
    q19,
    q20,
    q21,
    q22,
    q23,
    q24,
    q25,
    q26,
    q27,
    q29
  ) |>
  colnames()

# same for collapsed versions
qs_az.clps <- df |>
  select(
    q19.clps,
    q20.clps,
    q21.clps,
    q22.clps,
    q23.clps,
    q24.clps,
    q25.clps,
    q26.clps,
    q27.clps,
    q29.clps
  ) |>
  colnames()

# expectations of fraud
fraud_exp_az <- df |>
  select(q28_1, q28_2, q28_3, q28_4, q28_5) |>
  colnames()

# expectations of fraud, collapsed versions
fraud_exp_az.clps <- df |>
  select(q28_1.clps, q28_2.clps, q28_3.clps, q28_4.clps, q28_5.clps) |>
  colnames()

# function to compute the p-value for continuous or categorical variables
pvalue <- function(x, ...) {
    # Construct vectors of data y, and groups (strata) g
    y <- unlist(x)
    g <- factor(rep(1:length(x), times=sapply(x, length)))
    if (is.numeric(y)) {
        # For numeric variables, perform a standard 2-sample t-test
        p <- t.test(y ~ g)$p.value
    } else {
        # For categorical variables, perform a chi-squared test of independence
        p <- chisq.test(table(y, g))$p.value
    }
    # Format the p-value, using an HTML entity for the less-than sign.
    # The initial empty string places the output on the line below the variable label.
    c("", sub("<", "&lt;", format.pval(p, digits=3, eps=0.001)))
}

# Pearson's chi-squared test is performed of the null hypothesis that the joint
# distribution of the cell counts in a 2-dimensional contingency table is the
# product of the row and column marginals


# function to create crosstabs using janitor::tabyl()
tabyl.crabs <- function(x){
  crab_df <- df |> select(group, all_of(x)) |> 
    janitor::tabyl(group, !!sym(x), show_na = F)
}

# purrr::map() applies a function to each element of a list or atomic vector
# here I assign the output to 'az_crabs' which is a list of lists of dataframes
az_crabs <- map(qs_az, tabyl.crabs)



```

## Key Questions

::: {.panel-tabset}

## Q19 Barplot

```{r}
#| label: fig-q19
#| fig-cap: "Confidence in Accurate Vote Count by Experiment Condition"

az_crabs[[1]] |> 
  tidyr::pivot_longer(
    cols = -group,
    names_to = 'response',
    values_to = 'n'
  ) |> 
  ggplot(aes(y = n, fill = group, x = response))+
  geom_col(position = 'dodge')+
  # stat_count(geom = 'text', aes(label = ..count..), vjust = -0.5)+
  geom_text(aes(label = n), position = position_dodge(1.0), vjust = -0.5)+
  scale_fill_grey(start = 0.5, end = 0.1)+
  # \n in a string tells R to break the line there
  labs(y = "Count",
       x = "Q19. How confident are you that votes in Maricopa County, AZ \nwill be counted as voters intend in the elections this November?",
       fill = "Group\nExperiment\nCondition")+
  theme_bw()
```

## Q19 Crosstab

```{r}
#| label: tbl-q19
#| tbl-cap: "Q19. Confidence vote counts will be accurate in Maricopa County, AZ by Experiment Condition"

# Crosstab of Q19 by treatment group
az_crabs[[1]] |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |> 
  janitor::adorn_title(
    'combined',
    row_name = "Group",
    col_name = 'Q19') |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )



```

:::


::: {.panel-tabset}

## Q22 Barplot

```{r}
#| label: fig-q22
#| fig-cap: "Confidence in Fair Voting Process by Experiment Condition"

az_crabs[[4]] |> 
  tidyr::pivot_longer(
    cols = -group,
    names_to = 'response',
    values_to = 'n'
  ) |> 
  ggplot(aes(y = n, fill = group, x = response))+
  geom_col(position = 'dodge')+
  # stat_count(geom = 'text', aes(label = ..count..), vjust = -0.5)+
  geom_text(aes(label = n), position = position_dodge(1.0), vjust = -0.5)+
  scale_fill_grey(start = 0.5, end = 0.1)+
  # \n in a string tells R to break the line there
  labs(y = "Count",
       x = "Q22.How confident are you that the voting process will be fair in Maricopa County, AZ?",
       fill = "Group\nExperiment\nCondition")+
  theme_bw()
```

## Q22 Crosstab

```{r}
#| label: tbl-q22
#| tbl-cap: "Q22.Confidence in Fair Voting Process by Experiment Condition in Maricopa County, AZ by Experiment Condition"

# Crosstab of Q19 by treatment group
az_crabs[[4]] |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |> 
  janitor::adorn_title(
    'combined',
    row_name = "Group",
    col_name = 'Q22') |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )



```

:::

::: {.panel-tabset}

## Q25 Barplot

```{r}
#| label: fig-q25
#| fig-cap: "Concern for violence, threats, or voter intimidation in Maricopa County, AZ by Experiment Condition"

az_crabs[[7]] |> 
  tidyr::pivot_longer(
    cols = -group,
    names_to = 'response',
    values_to = 'n'
  ) |> 
  ggplot(aes(y = n, fill = group, x = response))+
  geom_col(position = 'dodge')+
  # stat_count(geom = 'text', aes(label = ..count..), vjust = -0.5)+
  geom_text(aes(label = n), position = position_dodge(1.0), vjust = -0.5)+
  scale_fill_grey(start = 0.5, end = 0.1)+
  # \n in a string tells R to break the line there
  labs(y = "Count",
       x = "Q25. Thinking about Maricopa County, AZ, how concerned should voters feel about \npotential violence, threats of violence, or intimidation while voting in person at their local polling place?",
       fill = "Group\nExperiment\nCondition")+
  theme_bw()
```


## Q25 Crosstab

```{r}
#| label: tbl-q25
#| tbl-cap: "Q25. Concern for violence, threats, or voter intimidation in Maricopa County, AZ by Experiment Condition"

# Crosstab of Q19 by treatment group
az_crabs[[7]] |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |> 
  janitor::adorn_title(
    'combined',
    row_name = "Group",
    col_name = 'Q25') |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )



```

:::

::: {.panel-tabset}

## Q26 Barplot

```{r}
#| label: fig-q26
#| fig-cap: "In-person voter safety in Maricopa County, AZ by Experiment Condition"

az_crabs[[8]] |> 
  tidyr::pivot_longer(
    cols = -group,
    names_to = 'response',
    values_to = 'n'
  ) |> 
  ggplot(aes(y = n, fill = group, x = response))+
  geom_col(position = 'dodge')+
  # stat_count(geom = 'text', aes(label = ..count..), vjust = -0.5)+
  geom_text(aes(label = n), position = position_dodge(1.0), vjust = -0.5)+
  scale_fill_grey(start = 0.5, end = 0.1)+
  # \n in a string tells R to break the line there
  labs(y = "Count",
       x = "Q26. How confident, if at all, are you that in person polling places in Maricopa County, AZ \nwill be safe places for voters to cast their ballots during the upcoming elections in November?",
       fill = "Group\nExperiment\nCondition")+
  theme_bw()

```


## Q26 Crosstab

```{r}
#| label: tbl-q26
#| tbl-cap: "Q26. In-person voter safety in Maricopa County, AZ by Experiment Condition"

# Crosstab of Q19 by treatment group
az_crabs[[8]] |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |> 
  janitor::adorn_title(
    'combined',
    row_name = "Group",
    col_name = 'Q26') |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )



```

:::


::: {.panel-tabset}

## Q27 Barplot

```{r}
#| label: fig-q27
#| fig-cap: "Approval of Election Officials in Maricopa County, AZ by Experiment Condition"

az_crabs[[9]] |> 
  tidyr::pivot_longer(
    cols = -group,
    names_to = 'response',
    values_to = 'n'
  ) |> 
  ggplot(aes(y = n, fill = group, x = forcats::fct_inorder(response)))+
  geom_col(position = 'dodge')+
  # stat_count(geom = 'text', aes(label = ..count..), vjust = -0.5)+
  geom_text(aes(label = n), position = position_dodge(1.0), vjust = -0.5)+
  scale_fill_grey(start = 0.5, end = 0.1)+
  # \n in a string tells R to break the line there
  labs(y = "Count",
       x = "Q27. Do you approve or disapprove of the way \nelection officials in Maricopa County, AZ are handling their jobs?",
       fill = "Group\nExperiment\nCondition")+
  theme_bw()

```


## Q27 Crosstab

```{r}
#| label: tbl-q27
#| tbl-cap: "Q27. Approval of Election Officials in Maricopa County, AZ by Experiment Condition"

# Crosstab of Q19 by treatment group
az_crabs[[9]] |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |> 
  janitor::adorn_title(
    'combined',
    row_name = "Group",
    col_name = 'Q27') |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )



```

:::


## Survey Questions by Treatment Condition

### Trust and Confidence in AZ Elections

The following cross-tables break down relative observations and percentages of responses to survey questions across categories of the survey's experimental condition. The survey questions in the table below concerned a respondent's degree of trust and confidence in the electoral process in Maricopa County, AZ.

```{r}
#| label: tbl-1
#| tbl-cap: "Trust and Confidence in Maricopa County, AZ Elections by Treatment Condition"
#| column: page
#| results: asis


# q19 to q27 by treatment condition. p-value based on chi^2 test of independence
tab1 <- table1::table1(
  ~ q19.clps
  + q20.clps
  + q21.clps
  + q22.clps
  + q23.clps
  + q24.clps
  + q25.clps
  + q26.clps
  + q27.clps
  + q29.clps | group,
  data = df,
  transpose = F,
  overall = F,
  render.missing = NULL,
  extra.col = list('P-value' = pvalue)
)


# convert table1 object to "kableExtra" "kintr_kable"
tab1 <- table1::t1kable(
  tab1, booktabs = T
  ) |>
  kableExtra::footnote(
    general = "Table reflects column percentages. \nP-values based on Pearson's Chi-squared test of independence."
  ) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    font_size = 13,
    fixed_thead = T
  )
# print table
print(tab1)


```

### Expectation of Electoral Fraud

The next table reviews a set of questions designed to assess a respondent's expectation of electoral fraud of some sort in Maricopa County, AZ. Again, responses are compared across categories of the survey experiment.

```{r}
#| label: tbl-2
#| tbl-cap: "Expectation of Electoral Fraud in Maricopa County, AZ by Treatment Condition"
#| column: page
#| results: asis

# q28_1 to q29 by treatment condition p-value based on chi^2 test of independence
tab2 <- table1::table1(
  ~ q28_1.clps
  + q28_2.clps
  + q28_3.clps
  + q28_4.clps
  + q28_5.clps
  | group,
  data = df,
  transpose = F,
  overall = F,
  render.missing = NULL,
  extra.col = list('P-value' = pvalue)
)

# convert table1 object to "kableExtra" "kintr_kable"
tab2 <- table1::t1kable(
  tab2,
  format = "html",
  booktabs = T ) |>
  kableExtra::footnote(
    general = "Table reflects column percentages. \nP-values based on Pearson's Chi-squared test of independence."
  ) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )

# print table
print(tab2)






```

## T-test Means comparison

```{r}
#| label: tbl-3
#| tbl-cap: "Two-sample T-test results by Experiment Condition"
#| column: body-outset-right
#| warning: false


## 2-sample t-tests for each dummified question by group condition
dums <- df |> select(group, contains("_dum"))

# makes df long
melted <- reshape2::melt(dums, id.vars = "group")

# conduct t-tests, assign to dum_ttests
dum_ttests <- melted |> group_by(variable) |> 
  rstatix::t_test(value ~ group, detailed = T) |> 
  rstatix::add_significance()

# relocate p.signif column
dum_ttests <- dum_ttests |> dplyr::relocate(c(p, p.signif), .after = conf.high)

# show only variables with stat.sig differences between experiment condition
dum_ttests <- dum_ttests |> 
  select(-5, -df, -alternative) |> 
  filter(p.signif != "ns") |> 
  arrange(variable)


kableExtra::kbl(
  dum_ttests,
  booktabs = T
  ) |>
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )





```


## Impacts on Confidence

### Impact on confidence in fairness and accuracy of elections

The following examines survey questions that asked respondents whether particular circumstances or election official actions would have any impact on their confidence in the fairness and accuracy of elections. Survey participants responded to six statements, all prefaced with the following,

> "Regardless of whether any of these are actually the case, how would the following impact your confidence in the fairness and accuracy of elections conducted this November?"

1.    Election officials test every machine used in the election to ensure they are secure.
2.    Election officials conduct audits of ballots after every election to confirm the results were accurate.
3.    Poll watchers affiliated with the political parties or candidates observe the election.
4.    Election staff and volunteers include military veterans and their family members from the community[^1].
5.    Election staff and volunteers include lawyers from the community.
6.    Election staff and volunteers include college students from the community.

For each statement, survey participants responded by selecting one of five response options:

1.    Decrease confidence a lot
2.    Decrease confidence somewhat
3.    No impact on confidence
4.    Increase confidence somewhat
5.    Increase confidence a lot


In the following table, responses were collapsed into three categories. Any increase in confidence (e.g., increase confidence a lot, increase confidence somewhat) were collapsed into one column, and likewise for any response indicating a decrease in confidence.

```{r}
#| label: tbl-4
#| tbl-cap: "Confidence Impact on Election Fairness and Accuracy"
#| column: body-outset-right
#| results: asis

# Simple Crosstab to show response breakdown by experiment condition
# 6 NAs omitted. 
df |>
  mutate(
    confimpct_vets = dplyr::case_when(
      q41.4.clps == "increase" ~ 'Increase Confidence',
      q41.4.clps == "no_impact" ~ 'No Impact',
      q41.4.clps == 'decrease' ~ 'Decrease Confidence'
      )) |> 
  janitor::tabyl(group, confimpct_vets,  show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages('row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = T) |> 
  janitor::adorn_ns("rear") |> 
  janitor::adorn_title(
    'combined',
    row_name = "Condition", 
    col_name = 'Election staff include veterans and family'
    ) |> 
  dplyr::relocate(
    "No Impact", .before = "Increase Confidence"
  ) |> 
  kableExtra::kbl() |> 
  kableExtra::footnote(
    general = "NA omitted. % (n)"
    ) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )
  

```


Of particular importance are responses to the statement which asked respondents to consider whether inclusion of military veterans and veteran's family members as election staff and volunteers has any impact on their confidence in the fairness and accuracy of elections in November. In this case, significant differences were observed between treatment and control groups. 

A -0.11 percentage point difference of proportion was observed between treatment and control groups among those who reported that their confidence in the fairness and accuracy of elections would "increase a lot" or "increase somewhat" when election staff and volunteers include (or consist of a majority of) military service veterans and their family members in the community. This difference of proportion is estimated with 95% confidence to be statistically significant (p < 0.01, CI [-0.169, -0.057]).  Conversely, no difference was observed between treatment and control groups among those who reported that their confidence would "decrease a lot" or "decrease somewhat".


[^1]: Two different versions of this statement was presented to survey participants. Half of the sample read the statement as, "Election staff and volunteers *include* military veterans and their family members from the community", whereas the other half of the sample read, "The *majority* of election staff and volunteers consist of military veterans and their family members from the community." No significant differences in responses were observed between those who read one version of the statement over the other. However, the same was done for statements number 5 and 6 which concern "lawyers from the community" and "college students from the community". Significant differences were found when comparing responses between the different versions of these statements. See the appendix for further discussion on these results.  


```{r}
#| label: tbl-5
#| tbl-cap: "Confidence Impact on Election Fairness and Accuracy"
#| results: asis


# confidence impact by treatment condition ::::::::::::::
tbl5 <- df |>
  mutate(
    confimpct_vets = dplyr::case_when(
      q41.4.clps == "increase" ~ 'Increase Confidence',
      q41.4.clps == "no_impact" ~ 'No increase',
      q41.4.clps == 'decrease' ~ 'No increase'
      )
    ) |>
  janitor::tabyl(group, confimpct_vets,  show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages('row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns("rear") |> 
  janitor::adorn_title(
    'combined', 
    row_name = "Condition",
    col_name = 'Election staff include veterans and family')


kableExtra::kbl(tbl5) |> 
  kableExtra::footnote(
    general = "NA omitted. % (n)"
    ) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )


```


```{r}
#| label: tbl-6
#| tbl-cap: "Difference of Proportions between Control and Treatment"
#| column: body-outset-right
#| results: asis

# conduct diff of proportions test by group condition
pt1 <- df |>
  mutate(
    confimpct_vets = dplyr::case_when(
      q41.4.clps == "increase" ~ 'Increase',
      q41.4.clps == "no_impact" ~ 'No increase',
      q41.4.clps == 'decrease' ~ 'No increase'
      ),
    group = dplyr::case_when(
      group == "Treatment" ~ 1,
      group == "Control" ~ 0
    )
    ) |>
  janitor::tabyl(group, confimpct_vets,  show_na = F) |> 
  select(-1) |> 
  rstatix::prop_test(detailed = T) 

# print results as table
pt1 |> 
  kableExtra::kbl(
    format.args = list(scientific = F),
    digits = 5) |> 
  kableExtra::footnote(general = "Two-sample z-test of equal proportions") |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )


```

These results suggest that reading a vignette about county efforts to recruit veterans as election staff and volunteers does more to increase one's confidence in the fairness and accuracy of elections, especially under the prospect that election staff and volunteers would include veterans and their family members.

### Impact on Confidence in Voter Safety at polling sites


The same analysis was conducted for questions that assessed the reported impact on confidence of safety while voting in-person. Survey participants provided responses to the same six statements as before, which were all prefaced with the following question,

> "How would the following impact your confidence that voters are safe from violence, threats of violence, or intimidation while voting in-person during elections this November?"

```{r}
#| label: tbl-7
#| tbl-cap: "Confidence Impact on In-person Voter Safety"
#| results: asis


# Simple Crosstab to show response breakdown by experiment condition
# 6 NAs omitted. 
df |>
  mutate(
    confimpct_vets = dplyr::case_when(
      q43.4.clps == "increase" ~ 'Increase Confidence',
      q43.4.clps == "no_impact" ~ 'No Impact',
      q43.4.clps == 'decrease' ~ 'Decrease Confidence'
      )) |> 
  janitor::tabyl(group, confimpct_vets,  show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages('row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = T) |> 
  janitor::adorn_ns("rear") |> 
  janitor::adorn_title(
    'combined',
    row_name = 'Condition',
    col_name = 'Election staff include veterans and family') |>
  dplyr::relocate(
    "No Impact", .before = "Increase Confidence"
  ) |> 
  kableExtra::kbl() |> 
  kableExtra::footnote(
    general = "NA omitted. % (n)"
    ) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )
  



```

Significant differences were observed between the treatment and control group among those who reported that their confidence in voter safety would increase when election staff and volunteers include (or consist of a majority of) military service veterans and their family members in the community. Here too, a negative difference of -0.082 percentage points when comparing responses of the treatment group to the control group are statistically significant with 95% confidence (p < 0.01, CI [-0.137, -0.082]).

```{r}
#| label: tbl-8
#| tbl-cap: "Confidence Impact on In-person Voter Safety"
#| results: asis

tbl8 <- df |>
  mutate(
    confimpct_vets = dplyr::case_when(
      q41.4.clps == "increase" ~ 'Increase Confidence',
      q41.4.clps == "no_impact" ~ 'No increase',
      q41.4.clps == 'decrease' ~ 'No increase'
      )
    ) |>
  janitor::tabyl(group, confimpct_vets,  show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages('row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns("rear") |> 
  janitor::adorn_title(
    'combined', 
    row_name = "Condition",
    col_name = 'Election staff include veterans and family')


kableExtra::kbl(
  tbl8
  ) |> 
  kableExtra::footnote(
    general = "NA omitted. % (n)"
    ) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )

```


```{r}
#| label: tbl-9
#| tbl-cap: "Difference of Proportions between Control and Treatment"
#| column: body-outset-right
#| results: asis


# prop.test. assign to pt2
pt2 <- df |>
  mutate(
    votersafety_vets = dplyr::case_when(
      q43.4.clps == "increase" ~ 'Increase',
      q43.4.clps == "no_impact" ~ 'No increase',
      q43.4.clps == 'decrease' ~ 'No increase'
      ),
    group = dplyr::case_when(
      group == "Treatment" ~ 1,
      group == "Control" ~ 0
    )
    ) |>
  janitor::tabyl(group, votersafety_vets,  show_na = F) |> 
  select(-1) |> 
  rstatix::prop_test(detailed = T)

# print results as table
pt2 |> 
  kableExtra::kbl(
    format.args = list(scientific = F),
    digits = 5
    ) |> 
  kableExtra::footnote(general = "Two-sample z-test of equal proportions") |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )



```

## T-tests Means comparison for Impact on Confidence

```{r}
#| label: tbl-10
#| tbl-cap: "Comparison of Means between Treatment and Control Condition"
#| column: body-outset-right
#| results: asis

ttq41 <- df |> 
  mutate(
    confimpct_vets_fair = dplyr::case_when(
      q41.4.clps == "increase" ~ 1,
      q41.4.clps == "no_impact" ~ 0,
      q41.4.clps == 'decrease' ~ 0
      ),
    group = dplyr::case_when(
      group == "Treatment" ~ 1,
      group == "Control" ~ 0
    )) |> 
  rstatix::t_test(
    formula = confimpct_vets_fair ~ group,
    paired = F, 
    conf.level = 0.95,
    detailed = T) |> 
  rstatix::add_significance()

ttq43 <- df |> 
  mutate(
    confimpct_vets_safe = dplyr::case_when(
      q43.4.clps == "increase" ~ 1,
      q43.4.clps == "no_impact" ~ 0,
      q43.4.clps == 'decrease' ~ 0
      ),
    group = dplyr::case_when(
      group == "Treatment" ~ 1,
      group == "Control" ~ 0
    )) |>
  rstatix::t_test(
    formula = confimpct_vets_safe ~ group,
    paired = F,
    conf.level = 0.95,
    detailed = T) |> 
  rstatix::add_significance()

ttq41 |>
  dplyr::add_row(ttq43) |>
  select(-df, -alternative) |> 
  dplyr::relocate(c(.y., group1, group2, n1, n2), .before = estimate) |>
  dplyr::relocate(p.signif, .after = p) |>
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )

```


# 3-way Crosstables 

::: {.callout-note}
This section is under construction. A select number of 3-way cross tables will be presented here.
:::



# Sample Demographics and Balance


Note that there are a total of 125 respondents who started but didn't finish the survey. Of those 125, 105 quit before reaching `Q40_1`, which explains why they weren't assigned an embedded `Qset` code (e.g., 'A' or 'B'). An additional 20 of those 125 quit the survey after `Q40_1`, which means they were assigned a `Qset` code.

Removing all blank `NA` missing values from the `Qset` variable removes those 105 partial survey responses, i.e., respondents who quit prior to reaching `Q40`.


```{r}
#| label: tbl-demog
#| tbl-cap: "Survey sample characteristics by treatment condition"
#| column: page
#| results: asis

# descriptive stats for df
t1.demog <- table1::table1(
  ~age_cat
  + gender_3cat
  + race
  + educ
  + partyid_3cat
  + milserv1
  + milserv2
  + milservfam
  + voted2020.clps
  + choice2020
  + voteintent
  | group,
  data = df,
  overall = "Overall",
  footnote = "Table reflects column percentages.")


t1.demog <- table1::t1kable(t1.demog) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    full_width = T,
    fixed_thead = T
  )

print(t1.demog)

```


# Appendix {.appendix}


## Differences from Question Wording  {.appendix}

::: {.callout-note}
This section is under construction. Resolution of various formatting issues are in progress.
:::


As mentioned previously, certain questions were included in the survey to assess whether certain actions taken by election officials or circumstances at polling sites would impact 1) one's confidence in the fairness and accuracy of upcoming elections, and 2) confidence in voter safety while voting in-person. These questions were presented to survey participants in a matrix-style format where they would select a response to different statements describing some electoral circumstance. 

In addition, it was hypothesized that different statement wording would have some effect on response choice to certain question item statements. In order to test this hypothesis, another set of the same questions were constructed and half of the sample was presented with one version of item statements, while the other half was presented with a different version in which a few statements were slightly modified. Specifically, three of the six statements in question set 'B' [`Q44`, `Q46`] differed from three statements in question 'A' [`Q41`, `Q43`]. See the table below for the full breakdown.  

```{r}
#| label: qset-setup
#| include: false


# create a table containing the differing statements for question sets A and B

qsetA <- df |> 
  select(q41_1:q46_6) |> 
  labelled::set_variable_labels(
    q41_1 = "Election officials test every machine used in the election to ensure they are secure.",
    q41_2 = "Election officials conduct audits of ballots after every election to confirm the results were accurate.",
    q41_3 = "Poll watchers affiliated with the political parties or candidates observe the election.",
    q41_4 = "Election staff and volunteers include military veterans and their family members from the community.",
    q41_5 = "Election staff and volunteers include lawyers from the community.",
    q41_6 = "Election staff and volunteers include college students from the community.",
    q43_1 = "Election officials ensure that law enforcement officers are present at polling sites.",
    q43_2 = "Poll watchers affiliated with the political parties or candidates observe the election.",
    q43_3 = "People holding signs or giving out literature in support of a candidate or ballot question.",
    q43_4 = "Election staff and volunteers include military veterans and their family members from the community.",
    q43_5 = "Election staff and volunteers include lawyers from the community.",
    q43_6 = "Election staff and volunteers include college students from the community."
    ) |> 
  surveytoolbox::varl_tb() |> 
  select(var, var_label) |> 
  dplyr::slice(1:12) |> 
  dplyr::rename('Qset A' = var,
                'A statements' = var_label)

qsetB <- df |> 
  select(q41_1:q46_6) |> 
  labelled::set_variable_labels(
    q44_1 = "Election officials test every machine used in the election to ensure they are secure.",
    q44_2 = "The majority of election staff and volunteers consist of military veterans and their family members from the community.",
    q44_3 = "The majority of election staff and volunteers consist of lawyers from the community.",
    q44_4 = "Election officials conduct audits of ballots after every election to confirm the results were accurate.",
    q44_5 = "Poll watchers affiliated with the political parties or candidates observe the election.",
    q44_6 = "The majority of election staff and volunteers consist of college students from the community.",
    q46_1 = "Election officials ensure that law enforcement officers are present at polling sites.",
    q46_2 = "The majority of election staff and volunteers consist of military veterans and their family members from the community.",
    q46_3 = "The majority of election staff and volunteers consist of lawyers from the community.",
    q46_4 = "Poll watchers affiliated with the political parties or candidates observe the election.",
    q46_5 = "The majority of election staff and volunteers consist of college students from the community.",
    q46_6 = "People holding signs or giving out literature in support of a candidate or ballot question."
    ) |> 
  surveytoolbox::varl_tb() |> 
  select(var, var_label) |> 
  dplyr::slice(13:24) |> 
  dplyr::rename('Qset B' = var,
                'B statements' = var_label)

# bind the dataframes together as one with two columns
qsetAB <- dplyr::bind_cols(qsetA, qsetB)
rm(qsetA, qsetB)
```


```{r}
#| label: tbl-qset
#| tbl-cap: "Question Numbers and Statements"
#| fig-cap: "Question Numbers and Statements"
#| column: page-inset-right


# create a table containing the differing statements for question sets A and B
kableExtra::kbl(qsetAB, format = 'html', align = 'l') |> 
  kableExtra::pack_rows("Regardless of whether any of these are actually the case, how would the following impact your confidence in the fairness and accuracy of elections conducted this November?", 1, 6) |>
  kableExtra::pack_rows("How would the following impact your confidence that voters are safe from violence, threats of violence, or intimidation while voting in-person during elections this November?", 7, 12) |>
  kableExtra::row_spec(c(2,9), align = 'l') |> 
  kableExtra::footnote(
    general ="Response options ranged from 'Decrease confidence a lot', 'Decrease confidence somewhat', 'No impact on confidence', 'Increase confidence somewhat', and 'Increase confidence a lot'.",
    footnote_as_chunk = T
  ) |> 
  kableExtra::kable_styling(
    font_size = 13,
    row_label_position = 'l',
    bootstrap_options = c('striped',
                          'bordered',
                          'hover',
                          'condensed',
                          'responsive'))

```


Survey participants were randomly grouped according to the set of questions presented to them, `Qset A` or `Qset B` respectively, and responses were analyzed to test for significant differences between the different item statements. If significant differences were observed for each modified item statement in comparison to the unmodified versions, then response effects could be attributed to the change in statement wording. However, if differences were significant for one or two of the statements but not all three, then response effects could not be attributed to statement wording alone. If no differences were found, then the responses from the two question sets would be considered equivalent and coalesced into one variable per question for subsequent analysis.


In order to test the statement-wording hypothesis, the five-point Likert item response options were re-coded as dichotomous 'dummy' variables. For instance, "Increase confidence a lot" and "Increase confidence somewhat" were collapsed and recoded such that "Increase" = 1, whereas all other responses were collapsed and re-coded such that "No increase" = 0. The same process was done for any "Decrease" responses. Proportions of responses were compared for both the 'Increase' and 'Decrease' dummy categories. See cross tables below. 

```{r}
#| label: law-school-setup1
#| include: false

# I coalesce these vars so I can put them in a cross tab by qset
law_skool <- df |> 
  group_by(rowID) |> 
  mutate(
    q41.5.clps = dplyr::coalesce(q41_5.clps, q44_3.clps),
    q41.6.clps = dplyr::coalesce(q41_6.clps, q44_6.clps),
    q43.5.clps = dplyr::coalesce(q43_5.clps, q46_3.clps),
    q43.6.clps = dplyr::coalesce(q43_6.clps, q46_5.clps),) |>
  ungroup() |>
  filter(!is.na(qset)) 

law_skool <- law_skool |> 
  select(qset, q41.5.clps, q41.6.clps, q43.5.clps, q43.6.clps) |> 
  mutate(
    fair_lawyers = dplyr::case_when(
      q41.5.clps == 'increase'  ~ 'Increase',
      q41.5.clps == 'no_impact'  ~ 'No increase',
      q41.5.clps == 'decrease'  ~ 'No increase',
      TRUE ~ NA
    )) |> 
  mutate(
    fair_students = dplyr::case_when(
      q41.6.clps == 'increase'  ~ 'Increase',
      q41.6.clps == 'no_impact'  ~ 'No increase',
      q41.6.clps == 'decrease'  ~ 'No increase',
      TRUE ~ NA
    )) |> 
  mutate(
    safe_lawyers = dplyr::case_when(
      q43.5.clps == 'increase'  ~ 'Increase',
      q43.5.clps == 'no_impact'  ~ 'No increase',
      q43.5.clps == 'decrease'  ~ 'No increase',
      TRUE ~ NA
    )) |> 
  mutate(
    safe_students = dplyr::case_when(
      q43.6.clps == 'increase'  ~ 'Increase',
      q43.6.clps == 'no_impact'  ~ 'No increase',
      q43.6.clps == 'decrease'  ~ 'No increase',
      TRUE ~ NA
    )) |> 
  select(qset, fair_lawyers, fair_students, safe_lawyers, safe_students) 

law_skool <- law_skool |> 
  mutate(qset = forcats::fct_recode(qset, Includes = "A", Majority = "B"))
```


```{r}
#| label: law-school-setup2
#| include: false

var_names <- law_skool[,2:5] |> colnames()

# function to run prop_tests over a list of crosstabs 
tabyl.fun <- function(x){
  crab_df <- law_skool |> select(qset, all_of(x)) |> 
    janitor::tabyl(qset, !!sym(x), show_na = F) |> 
    select(-1) |> 
    rstatix::prop_test(detailed = T)
}

# this maps the function tabyl.fun to each character string in 'var_names'
# the results are put into a list of tibbles, in this case, a list of 4 tibbles
law_skool_prop_tests <- map(var_names, tabyl.fun)

# I combine the 4 tibbles within the list into a single tibble
pt_lawyers_students <- purrr::reduce(law_skool_prop_tests, dplyr::full_join)

# add column that identifies rows of different prop_tests
pt_lawyers_students$items <- var_names

# add column that identifies response compared
response <- c("Increase", "Increase", "Increase", "Increase")
pt_lawyers_students$response <- response



# relocate columns to better positions, rename columns, remove df column
pt_lawyers_students <- pt_lawyers_students |>
  dplyr::relocate(c(items, response), .before = n) |>
  dplyr::relocate(p.signif, .after = p) |>
  dplyr::rename(valid_n = n,
                Qset_A_n = n1,
                Qset_B_n = n2) |>
  dplyr::mutate(prop.diff = estimate1 - estimate2,
                .before = statistic) |> 
  select(-df)
```


```{r}
#| label: tbl-fair-lawyers
#| tbl-cap: "'Increase' confidence in election fairness by question wording: Lawyers"
#| fig-cap: "Proportion of those who report an 'Increase' in confidence in fairness of elections when election staff either 'Includes' or is a 'majority' of lawyers"


# crabs
law_skool |> 
  janitor::tabyl(qset, fair_lawyers, show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |> 
  janitor::adorn_title(
    'combined',
    row_name = "Wording") |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )
```


```{r}
#| label: tbl-fair-students
#| tbl-cap: "'Increase' confidence in election fairness by question wording: College Students"
#| fig-cap: "Proportion of those who report an 'Increase' in confidence in fairness of elections when election staff either 'Includes' or is a 'majority' of college students"

# crabs
law_skool |> 
  janitor::tabyl(qset, fair_students, show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |> 
  janitor::adorn_title(
    'combined',
    row_name = "Wording") |>  
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )
```


```{r}
#| label: tbl-safe-lawyers
#| tbl-cap: "'Increase' confidence in voter safety by question wording: Lawyers"
#| fig-cap: "Proportion of those who report an 'Increase' in confidence in voter safety when election staff either 'Includes' or is a 'majority' of college students"


# crabs
law_skool |> 
  janitor::tabyl(qset, safe_lawyers, show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |>  
  janitor::adorn_title(
    'combined',
    row_name = "Wording") |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )
```


```{r}
#| label: tbl-safe-students
#| tbl-cap: "'Increase' confidence in voter safety by question wording: College Students"
#| fig-cap: "'Increase' confidence in voter safety by question wording: College Students"


# crabs
law_skool |> 
  janitor::tabyl(qset, safe_students, show_na = F) |> 
  janitor::adorn_totals('both') |> 
  janitor::adorn_percentages(denominator = 'row') |> 
  janitor::adorn_pct_formatting(digits = 2, affix_sign = F) |> 
  janitor::adorn_ns() |>  
  janitor::adorn_title(
    'combined',
    row_name = "Wording") |> 
  kableExtra::kbl() |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13
  )


```


Significant differences were found between the following items; 


|Qset A |A statements                                  |Qset B |B statements                                  |
|:------|:---------------------------------------------|:------|:---------------------------------------------|
|q41_5  |Election staff include lawyers                |q44_3  |Majority of Election staff are lawyers        |
|q41_6  |Election staff include college students       |q44_6  |Majority of Election staff are students       |
|q43_5  |Election staff includes lawyers               |q46_3  |Majority of Election staff are lawyers        |
|q43_6  |Election staff includes students              |q46_5  |Majority of Election staff are students       |

```{r}
#| label: pt-law-school
#| tbl-cap: "Prop. Test Results Comparing Qset A to Qset B"
#| fig-cap: "Prop. Test Results Comparing Qset A to Qset B"
#| column: page-inset-right
#| echo: false


# print prop_tests as table 
kableExtra::kbl(
  pt_lawyers_students,
  format = 'html',
  format.args = list(scientific = F),
  digits = 5
  ) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "bordered", "condensed", "responsive"),
    latex_options = "basic",
    font_size = 13,
    fixed_thead = T
  )

```



Comparison of responses between `Qset A` and `Qset B` revealed differences in response to item statements concerning lawyers and students. The difference in proportions were initially attributed to the different statement wording between question sets A and B, but also appear to be conditional on the group identified in the statement. That is, significant differences were observed when a statement read, "The majority of election staff and volunteers consist of lawyers/college students in the community" (qset B) compared to when a statement read, "Election staff and volunteers includes lawyers/college students in the community" (qset A). 

Moreover, the direction of the difference remained consistent. Confidence in fairness and accuracy of elections, as well as confidence in voter safety at the polls, was reported to increase less and decrease more under the prospect of having the majority of election staff consist of lawyers/college students compared to when election staff is said to merely *include* lawyers/college students. 

To put in other words, there was a higher proportion of those who reported that their confidence in fairness and voter safety would decrease among those who read that the majority of election staff consists of either lawyers or college students compared to those who read that election staff merely included lawyers or college students. Conversely, no significant differences were observed between question/statement wording when the group was identified as military veterans and their family members in the community. 

These results suggest that the differences in proportion initially attributed to question/statement wording are likely an artifact of a rival cause, potentially related to general impressions of the groups involved.  


Where proportions between the two independent samples were equivalent (i.e., no significant differences in proportion were found), responses were coalesced (i.e., merged) into one variable.

-   Q44_1 coalesced into Q41_1
-   Q44_4 coalesced into Q41_2
-   Q44_5 coalesced into Q41_3
-   Q44_2 coalesced into Q41_4
-   Q46_1 coalesced into Q43_1
-   Q46_4 coalesced into Q43_2
-   Q46_6 coalesced into Q43_3
-   Q46_2 coalesced into Q43_4

