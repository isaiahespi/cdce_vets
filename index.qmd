---
title: "Survey Experiment"
author:
  - name: Isaiah
    #orcid: 0000-0002-0760-5497
    #corresponding: true
    degrees:
    email: gespinoz@umd.edu
    roles:
      - Research Assistant
      - Reviewer
      - Analyst
    affiliations:
      - Center for Democracy and Civic Engagement
      - University of Maryland at College Park 
  # - name: Rowan Cockett
  #   orcid: 0000-0002-7859-8394
  #   corresponding: false
  #   roles: []
  #   affiliations:
  #     - Curvenote

phone: (410) 903 6911
email: ssnovey@umd.edu
department: Center for Democracy and Civic Engagement
keywords:
  - Election Workers
  - Poll workers
  - Veterans
  - Public opinion
  - Election administration
plain-language-summary: |
  Analysis and results of survey experiment.
key-points:  
  - Lorem ipsum odor amet, consectetuer adipiscing elit.
  - Lorem ipsum odor amet, consectetuer adipiscing elit.
  - Lorem ipsum odor amet, consectetuer adipiscing elit.
date: 2024-09-12
# bibliography: references.bib
# csl: american-political-science-association.csl
link-citations: true
tbl-cap-location: top
reference-location: document
notebook-view: false
notebook-links: false
citation:
  container-title: Center for Democracy and Civic Engagement, University of Maryland
number-sections: false
---


## Introduction

```{r}
#| label: packages
#| echo: false
#| output: false

# load packages
library(tidyverse)
library(janitor)
library(kableExtra)
library(gtsummary)
library(gt)
library(easystats)
library(labelled)
library(sjlabelled)
library(pewmethods)
library(surveytoolbox)


```


```{r}
#| label: load-df
#| include: false

# load data
load("data/df-2024-09-11.Rdata") # df set as factor with dummy vars
load("data/data_numeric_vets_survey-exp-2024-09-11.Rdata") # numeric only


```


```{r}
#| label: df-dict

# load data dictionary/codebook
df_dict <- read.csv("codebooks/df_dict.csv")

```

```{r}
#| label: var-names
#| include: false


# assign column names as character vectors. 
# qs = questions, 
# clps = collapsed levels 
# ex.clps = explanatory variables collapsed
qs.clps <- df |>
  select(contains(".clps"), -q5.clps, -q6.clps, -q8.clps, -q7) |>
  colnames()

ex.clps <- df |> select(q5.clps, q6.clps, q7, q8.clps) |> colnames()



```

```{r}
#| label: setup-functions
#| include: false

# make crabs kable style
make_crab_as_kable <- function(x, y){
  crab_gtkbl_df <- df |> 
    select(group, all_of(x), all_of(y)) |>
    dplyr::mutate(group = forcats::fct_rev(group)) |> 
    gtsummary::tbl_strata(
    strata = group,
    ~ .x |>
      gtsummary::tbl_cross(
        row = !!sym(x),
        col = !!sym(y),
        percent = "row",
        statistic = "{p}%",
        margin = "row",
        missing = "no"
      )
  ) |> 
    gtsummary::bold_labels() |> 
    gtsummary::as_kable_extra(
      booktabs = T,
      longtable = T,
      linesep = ""
    ) |> 
    kableExtra::kable_styling(
      position = "left",
      bootstrap_options = c("striped", "hover", "responsive")
    )
}

# make crabs gt style
make_crab_gtsummary <- function(x, y){
  crab_gt_df <- df |> select(group, all_of(x), all_of(y)) |>
    dplyr::mutate(group = forcats::fct_rev(group)) |> 
    gtsummary::tbl_strata(
    strata = group,
    ~ .x |>
      gtsummary::tbl_cross(
        row = !!sym(x),
        col = !!sym(y),
        percent = "row",
        statistic = "{p}%",
        margin = "row",
        missing = "no"
      )
  ) |> 
    gtsummary::bold_labels() |> 
    gtsummary::as_gt() |> 
    gt::tab_footnote("NA omitted. Table reflects row percentages") |>
    gt::tab_options(table.font.size = "small",
                    data_row.padding = gt::px(1))
}


```

```{r}
#| label: make-kbl-crabs
#| include: false


# using map2(), I can iterate a function over two arguments at a time, which
# would be the variables of interest in the dataframe
kbl_crabs.q5 <- map2(ex.clps[1], qs.clps[1:9], make_crab_as_kable)
kbl_crabs.q6 <- map2(ex.clps[2], qs.clps[1:9], make_crab_as_kable)
kbl_crabs.q7 <- map2(ex.clps[3], qs.clps[1:9], make_crab_as_kable)
kbl_crabs.q8 <- map2(ex.clps[4], qs.clps[1:9], make_crab_as_kable)

```

# Overview of demographic variables and balance

```{r}
#| label: tbl-1



# table of treatment and control groups
df |>
  gtsummary::tbl_summary(
    by = group,
    include = c(age, gender, race, educ, milserv1, milserv2, milservfam),
    statistic = list(
      age ~ "{mean} ({sd})",
      gtsummary::all_categorical() ~ "{n} ({p}%)"
    ),
    type = list(
      milserv1 ~ "categorical",
      milserv2 ~ "categorical",
      milservfam ~ "categorical"
    ),
    missing = "ifany"
  ) |>
  gtsummary::add_n() |>
  gtsummary::add_overall() |>
  gtsummary::modify_header(label = "**Variable**") |>
  gtsummary::bold_labels() |>
  gtsummary::as_gt() |>
  gt::tab_header("Description of Sample") |>
  gt::tab_footnote("Failure to complete survey, n = 120") |>
  gt::tab_options(table.font.size = "small",
                  data_row.padding = gt::px(1))



```



## Q5. Attention Paid to Political Affairs

```{r}
#| label: tbl-q5q26



# This is, essentially, a 3-way crosstab shwoing x across y by z
# The only problem is that the variable lable for the column question is omitted
df |>
  labelled::set_variable_labels(
    q26.clps = "Confidence Maricopa County, AZ will be safe for voters",
    q5.clps = "Attentiveness to Political Affairs"
  ) |> 
  mutate(group = forcats::fct_rev(group)) |> 
  gtsummary::tbl_strata(
    strata = group,
    ~ .x |>
      gtsummary::tbl_cross(
        row = q5.clps,
        col = q26.clps,
        statistic = "{p}%",
        percent = "row",
        margin = "row",
        missing = "no"
      )
  ) |>
  gtsummary::bold_labels() |>
  gtsummary::as_gt() |> 
  gt::tab_header(
    title = gt::md("**Will Maricopa County, AZ be Safe for Voters?**")) |> 
  gt::tab_footnote("NA omitted. Table reflects row percentages") |> 
  gt::tab_options(
    table.font.size = "small",
    data_row.padding = gt::px(1))


```




## Testing without use of functions
The following crosstabulations 



